!function(){"use strict";var t,e={};t="undefined"!=typeof module?module.exports=e:function(){return this||(1,eval)("this")}(),t.xblocks=e,function(t){t.merge=function(e,n){return"object"!==t.type(e)&&(e={}),Object.keys(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e},t.type=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},t.noop=function(){},t.equals=function(e,n){if(e===n)return!0;if(!(e instanceof Object&&n instanceof Object))return!1;if(e.constructor!==n.constructor)return!1;for(var r in e)if(e.hasOwnProperty(r)){if(!n.hasOwnProperty(r))return!1;if(e[r]!==n[r]){if("object"!=typeof e[r])return!1;if(!t.equals(e[r],n[r]))return!1}}for(r in n)if(n.hasOwnProperty(r)&&!e.hasOwnProperty(r))return!1;return!0},t.isEmptyObject=function(e){if("object"!==t.type(e))return!0;for(var n in e)if(e.hasOwnProperty(n))return!1;return!0},t.filterObject=function(t,e){var n={};return Object.keys(t).forEach(function(r){var o=Object.getOwnPropertyDescriptor(t,r);e&&e(r,o)&&Object.defineProperty(n,r,o)}),n},t.mapObject=function(e,n){var r={};return Object.keys(e).forEach(function(o){var i=Object.getOwnPropertyDescriptor(e,o),s=n&&n(o,i);"object"===t.type(s)&&Object.defineProperty(r,s.name,s.descr)}),r}}(e),function(t){t.dom={},t.dom.attrs={},t.dom.attrs.ARRTS_BOOLEAN=["checked","selected","disabled","readonly","multiple","ismap","defer","autofocus","xb-static"],t.dom.attrs.getRealValue=function(e,n){return"true"===n||"false"===n||-1!==t.dom.attrs.ARRTS_BOOLEAN.indexOf(e)?""===n||e===n||"true"===n:n},t.dom.attrs.toObject=function(e){if(1!==e.nodeType)return{};var n={};return Array.prototype.forEach.call(e.attributes,function(e){n[e.nodeName]=t.dom.attrs.getRealValue(e.nodeName,e.value)}),n}}(e),function(t,e){var n={};t.view={},t.view.register=function(t,r){return r.mixins=Array.isArray(r.mixins)?r.mixins:[],r.mixins.push(n),e.DOM[t]=e.createClass(r)},t.view.get=function(t){return e.DOM[t]}}(e,React),function(t,e){e.create=function(n,r){return r="object"==typeof r?r:{},r.lifecycle={created:function(){this.xblock=e.element.create(this)},removed:function(){this.xblock.destroy(),delete this.xblock}},t.register(n,r)}}(xtag,e),function(t,e,n){function r(t){this._name=t.tagName.toLowerCase(),this._node=t,this._init(null,this._callbackInit)}e.element={},e.element.create=function(t){return new r(t)},r.prototype._name=void 0,r.prototype._node=null,r.prototype._component=null,r.prototype._observer=null,r.prototype.destroy=function(){n.unmountComponentAtNode(this._node),this.unmount()},r.prototype.unmount=function(){this._observer&&this._observer.disconnect(),this._isMountedComponent()&&(this._component.unmountComponent(),this._component=null)},r.prototype.update=function(t,n){if(this._isMountedComponent()){var r=this._getNodeProps(t),o="setProps";if(Array.isArray(n)&&n.length){o="replaceProps";var i=this._getCurrentProps();r=e.merge(i,r),r=e.filterObject(r,function(t){return-1===n.indexOf(t)})}r.hasOwnProperty("xb-static")?this._repaint():this._component[o](r)}},r.prototype._init=function(r,o){if(!this._isMountedComponent()){var i=this._getNodeProps(r),s=this._node.innerHTML||i.children,c=e.view.get(this._name)(i,s);i.hasOwnProperty("xb-static")?(this.unmount(),t.innerHTML(this._node,n.renderComponentToString(c))):this._component=n.renderComponent(c,this._node,this._callbackRender.bind(this,o))}},r.prototype._repaint=function(){var t=this._getCurrentProps();this.destroy(),this._init(t,this._callbackRepaint)},r.prototype._callbackInit=function(){t.fireEvent(this._node,"xb-created",{bubbles:!1,cancelable:!1,detail:{xblock:this}})},r.prototype._callbackRepaint=function(){t.fireEvent(this._node,"xb-repaint",{bubbles:!1,cancelable:!1})},r.prototype._callbackRender=function(t){this._observer||(this._observer=new MutationObserver(this._callbackMutation.bind(this))),this._observer.observe(this._node,{attributes:!0,childList:!0,characterData:!0,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1}),t&&t.call(this)},r.prototype._callbackMutation=function(t){if(this._isMountedComponent())if(t.some(this._checkNodeChange))this._repaint();else if(t.some(this._checkAttributesChange)){var e=t.filter(this._filterAttributesRemove,this).map(this._mapAttributesName);this.update(null,e)}},r.prototype._getNodeProps=function(t){var n=e.dom.attrs.toObject(this._node);return"object"===e.type(t)&&e.merge(n,t),n},r.prototype._isMountedComponent=function(){return this._component&&this._component.isMounted()},r.prototype._getCurrentProps=function(){return this._isMountedComponent()?this._component.props:null},r.prototype._checkNodeChange=function(t){return"childList"===t.type},r.prototype._checkAttributesChange=function(t){return"attributes"===t.type},r.prototype._filterAttributesRemove=function(t){return"attributes"===t.type&&!this._node.hasAttribute(t.attributeName)},r.prototype._mapAttributesName=function(t){return t.attributeName}}(xtag,e,React)}();