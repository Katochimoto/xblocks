!function(){"use strict";var t={},e=function(){return this||(1,eval)("this")}();e.xblocks=t,function(t,e){function n(t){return h[f]=o.apply(e,t),f++}function o(t){var n=[].slice.call(arguments,1);return function(){"function"==typeof t?t.apply(e,n):new Function(""+t)()}}function r(t){if(m)setTimeout(o(r,t),0);else{var e=h[t];if(e){m=!0;try{e()}finally{i(t),m=!1}}}}function i(t){delete h[t]}function s(){d=function(){var t=n(arguments);return process.nextTick(o(r,t)),t}}function u(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}function a(){var e="setImmediate$"+Math.random()+"$",o=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&r(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),d=function(){var o=n(arguments);return t.postMessage(e+o,"*"),o}}function c(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;r(e)},d=function(){var e=n(arguments);return t.port2.postMessage(e),e}}function l(){var t=_.documentElement;d=function(){var e=n(arguments),o=_.createElement("script");return o.onreadystatechange=function(){r(e),o.onreadystatechange=null,t.removeChild(o),o=null},t.appendChild(o),e}}function p(){d=function(){var t=n(arguments);return setTimeout(o(r,t),0),t}}if(!t.setImmediate){var d,f=1,h={},m=!1,_=t.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(t);y=y&&y.setTimeout?y:t,"[object process]"==={}.toString.call(t.process)?s():u()?a():t.MessageChannel?c():_&&"onreadystatechange"in _.createElement("script")?l():p(),y.setImmediate=d,y.clearImmediate=i}}(new Function("return this")()),function(t,e,n){e.utils={},e.utils.REG_TYPE_EXTRACT=/\s([a-zA-Z]+)/,e.utils.support={template:"content"in t.document.createElement("template")},e.utils.uid=function(){return Math.floor(268435456*(1+Math.random())+Date.now()).toString(36)},e.utils.merge=function(){var t,o,r,i,s,u,a=arguments[0]||{},c=1,l=arguments.length,p=!1;for("boolean"==typeof a&&(p=a,a=arguments[c]||{},c++),"object"!=typeof a&&"function"!==e.utils.type(a)&&(a={}),c===l&&(a=this,c--);l>c;c++)if(null!==(t=arguments[c]))for(o in t)r=a[o],i=t[o],a!==i&&(p&&i&&(e.utils.isPlainObject(i)||(s=Array.isArray(i)))?(s?(s=!1,u=r&&Array.isArray(r)?r:[]):u=r&&e.utils.isPlainObject(r)?r:{},a[o]=e.utils.merge(p,u,i)):i!==n&&(a[o]=i));return a},e.utils.type=function(t){return Object.prototype.toString.call(t).match(e.utils.REG_TYPE_EXTRACT)[1].toLowerCase()},e.utils.isPlainObject=function(t){return"object"!==e.utils.type(t)||t.nodeType||e.utils.isWindow(t)?!1:t.constructor&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},e.utils.isWindow=function(t){return null!==t&&t===t.window},e.utils.equals=function(t,n){if(t===n)return!0;if(!(t instanceof Object&&n instanceof Object))return!1;if(t.constructor!==n.constructor)return!1;var o;for(o in t)if(t.hasOwnProperty(o)){if(!n.hasOwnProperty(o))return!1;if(t[o]===n[o])continue;if("object"!=typeof t[o])return!1;if(!e.utils.equals(t[o],n[o]))return!1}for(o in n)if(n.hasOwnProperty(o)&&!t.hasOwnProperty(o))return!1;return!0},e.utils.isEmptyObject=function(t){if("object"===e.utils.type(t))for(var n in t)return!1;return!0},e.utils.filterObject=function(t,e){var n={};return Object.keys(t).forEach(function(o){var r=Object.getOwnPropertyDescriptor(t,o);e&&e(o,r)&&Object.defineProperty(n,o,r)}),n},e.utils.mapObject=function(t,n){var o={};return Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r),s=n&&n(r,i);"object"===e.utils.type(s)&&Object.defineProperty(o,s.name,s.descr)}),o},e.utils.lazyCall=function(e,n){return e._args=(e._args||[]).concat(n),e._timer||(e._timer=t.setImmediate(function(){e._timer=0,e(e._args.splice(0,e._args.length))})),e},e.utils.pristine=function(e){var n=t[e];if(!e||!n)return!1;if(!new RegExp("^[\\$_a-z][\\$\\w]*$","i").test(e))return!1;if("function"!=typeof n&&"object"!=typeof n)return!1;var o=new RegExp("function\\s+"+e+"\\(\\s*\\)\\s*{\\s*\\[native code\\]\\s*}");return o.test(n)?"function"!=typeof n||n.valueOf&&n.valueOf()===n?!0:!1:!1},e.utils.CustomEvent=function(){if(e.utils.pristine("CustomEvent"))return t.CustomEvent;var o=function(t,o){o=e.utils.merge({bubbles:!1,cancelable:!1,detail:n},o||{});var r=document.createEvent("CustomEvent");return r.initCustomEvent(t,o.bubbles,o.cancelable,o.detail),r};return o.prototype=t.Event.prototype,o}()}(e,t),function(t){t.dom={},t.dom.attrs={},t.dom.attrs.ARRTS_BOOLEAN=["active","autofocus","checked","defer","disabled","ismap","multiple","readonly","selected","xb-static"],t.dom.attrs.XB_ATTRS={STATIC:"xb-static"},t.dom.attrs.getRealValue=function(e,n){return"true"===n||"false"===n||-1!==t.dom.attrs.ARRTS_BOOLEAN.indexOf(e)?""===n||e===n||"true"===n:n},t.dom.attrs.toObject=function(e){if(1!==e.nodeType)return{};var n={};return Array.prototype.forEach.call(e.attributes,function(e){n[e.nodeName]=t.dom.attrs.getRealValue(e.nodeName,e.value)}),n}}(t),function(t,e){var n={};e.view={},e.view.create=function(o){return Array.isArray(o.mixins)||(o.mixins=[]),o.mixins.push(n),e.utils.isPlainObject(o.propTypes)||(o.propTypes={}),o.propTypes._uid=t.React.PropTypes.string,t.React.createClass(o)},e.view.register=function(n,o){if(t.React.DOM.hasOwnProperty(n))throw'Specified item "'+n+'" is already defined';return t.React.DOM[n]=e.view.create(o),t.React.DOM[n]},e.view.get=function(e){return t.React.DOM[e]}}(e,t),function(t,e){e.create=function(n,o){return o=e.utils.isPlainObject(o)?o:{},e.utils.merge(!0,o,{lifecycle:{created:function(){this.xblock=e.element.create(this)},inserted:function(){},removed:function(){this.xblock.destroy(),delete this.xblock},attributeChanged:function(t,n,o){this.xblock._isMountedComponent()||t===e.dom.attrs.XB_ATTRS.STATIC&&null===o&&this.xblock._repaint()}},accessors:{content:{get:function(){return this.xblock._getNodeContent()},set:function(t){this.xblock._setNodeContent(t)}}}}),t.xtag.register(n,o)}}(e,t),function(t,e,n){function o(t){this._uid=e.utils.uid(),this._name=t.tagName.toLowerCase(),this._node=t,this._init(this._getNodeProps(),this._getNodeContent(),this._callbackInit)}function r(n){t.dispatchEvent(new e.utils.CustomEvent("xb-created",{detail:{records:n}}))}function i(n){t.dispatchEvent(new e.utils.CustomEvent("xb-repaint",{detail:{records:n}}))}e.element={},e.element.create=function(t){return new o(t)},o.prototype._uid=n,o.prototype._name=n,o.prototype._node=null,o.prototype._component=null,o.prototype._observer=null,o.prototype.destroy=function(){t.React.unmountComponentAtNode(this._node),this.unmount()},o.prototype.unmount=function(){this._observer&&this._observer.disconnect(),this._isMountedComponent()&&(this._component.unmountComponent(),this._component=null)},o.prototype.update=function(t,n){if(this._isMountedComponent()){var o=this._getNodeProps(),r="setProps";if(e.utils.merge(!0,o,t),Array.isArray(n)&&n.length){r="replaceProps";var i=this._getCurrentProps();o=e.utils.merge(!0,i,o),o=e.utils.filterObject(o,function(t){return-1===n.indexOf(t)})}o.hasOwnProperty(e.dom.attrs.XB_ATTRS.STATIC)?this._repaint():(this._component[r](o),this._upgradeNode())}},o.prototype._init=function(n,o,r){if(!this._isMountedComponent()){n._uid=this._uid;var i=e.view.get(this._name)(n,o);n.hasOwnProperty(e.dom.attrs.XB_ATTRS.STATIC)?(this.unmount(),this._node.innerHTML=t.React.renderComponentToStaticMarkup(i),this._upgradeNode(),r&&r.call(this)):this._component=t.React.renderComponent(i,this._node,this._callbackRender.bind(this,r))}},o.prototype._repaint=function(){var t=e.utils.merge(!0,this._getNodeProps(),this._getCurrentProps()),n=this._getNodeContent();this.destroy(),this._init(t,n,this._callbackRepaint)},o.prototype._callbackInit=function(){var t=new e.utils.CustomEvent("xb-created",{detail:{xblock:this}});this._node.dispatchEvent(t),e.utils.lazyCall(r,this._node)},o.prototype._callbackRepaint=function(){var t=new e.utils.CustomEvent("xb-repaint",{detail:{xblock:this}});this._node.dispatchEvent(t),e.utils.lazyCall(i,this._node)},o.prototype._callbackRender=function(t){this._upgradeNode(),this._observer||(this._observer=new MutationObserver(this._callbackMutation.bind(this))),this._observer.observe(this._node,{attributes:!0,childList:!0,characterData:!0,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1}),t&&t.call(this)},o.prototype._callbackMutation=function(t){if(this._isMountedComponent())if(t.some(this._checkNodeChange))this._repaint();else if(t.some(this._checkAttributesChange)){var e=t.filter(this._filterAttributesRemove,this).map(this._mapAttributesName);this.update(null,e)}},o.prototype._upgradeNode=function(){t.CustomElements&&t.CustomElements.upgradeAll(this._node)},o.prototype._getNodeProps=function(){return e.dom.attrs.toObject(this._node)},o.prototype._getNodeContentElement=function(){if(!this._node.childNodes.length)return null;var e=this._node.querySelector('[data-xb-content="'+this._uid+'"]');if(!e&&(e=this._node.querySelector('script[type="text/template"]'),(!e||e.parentNode!==this._node)&&(e=this._node.querySelector("template"),e&&e.parentNode===this._node))){var n=t.document.createElement("div");n.appendChild(t.document.importNode(e.content,!0)),e=n}return e},o.prototype._getNodeContent=function(){if(this._isMountedComponent())return this._component.props.children;var t=this._getNodeContentElement();return t?t.innerHTML:this._node.innerHTML},o.prototype._setNodeContent=function(t){if(this._isMountedComponent())this.update({children:t});else{var e=this._getNodeContentElement();e&&(e.innerHTML=t,this._upgradeNode())}},o.prototype._isMountedComponent=function(){return this._component&&this._component.isMounted()},o.prototype._getCurrentProps=function(){return this._isMountedComponent()?this._component.props:null},o.prototype._checkNodeChange=function(t){return"childList"===t.type},o.prototype._checkAttributesChange=function(t){return"attributes"===t.type},o.prototype._filterAttributesRemove=function(t){return"attributes"===t.type&&!this._node.hasAttribute(t.attributeName)},o.prototype._mapAttributesName=function(t){return t.attributeName}}(e,t)}();